
<!-- ================================================================================================================================================ -->
<!-- User wait for admin to confirm him OR user was blocked by admin -->

<app-user-status *ngIf = "user.permission == 4 || user.permission == 5" [permission] = "user.permission"></app-user-status>

<!-- ================================================================================================================================================ -->
<!-- If user is a coach or manager -->

<div *ngIf = "user.permission != 4 && user.permission !=5">

  |<!-- Page header -->
  <app-page-header [item] = "header"> </app-page-header>


  <!-- Page content -->
  <div class = "container">

    <!-- Selecting chat room or adding a new one -->
    <div *ngIf = "noChatRoomSelected && !createNewChatRoom" >
      <div class = "row" >

      <div class = "container">
            <button (click) = "newChatRoom()" type = "button" class = "btn btn-success btn-block" > <i class = "fa fa-plus" > </i> יצירת חדר צ׳אט חדש </button>
      </div>
    
      <p>
        
      <div class = "vertical-menu chat-rooms">
          <div *ngFor = "let chatRoom of chatRooms | async" class = "list-group text-right">
              <span class = "list-group-item clearfix direction-rtl" (click) = "enterChatRoom(chatRoom)">  
                  <span class = "text-bold"> {{ chatRoom.name }} </span> <br> <span id = "author-name"> פותח: {{ chatRoom.authorName }} </span>
                  <span class = "fa fa-message"></span>
                  <span *ngIf = "user.uid == chatRoom.authorID" class = "pull-left">
                      <span class = "glyphicon glyphicon-trash" (click) = "removeChatRoom(chatRoom)"></span>
                  </span>
              </span>
          </div>
      </div>
    </div>
  </div>

  <!-- /Selecting chat room or adding a new one -->
  <!-- ================================================================================================================================================ -->
  <!-- Create a new chat room -->

  <div *ngIf = "createNewChatRoom">
    <h4 class = "create-chat text-center"> אנא בחר את נושא הצ׳אט ולחץ על <br> ״יצירת צ׳אט״ </h4>

  <br>

    <form class = "form-signin">
        <label for = "name" class = "sr-only"> נושא הצ׳אט </label>
        <div class = "input-group">
          <input #name type = "text" id = "name" class = "form-control" placeholder = "נושא הצ׳אט" required>
            <span class = "input-group-addon"><i class = "fa fa-pencil"></i></span> 
        </div>

        <br>

        <button (click) = "name.value && createsNewChatRoom(name.value) " class = "btn btn-md btn-success btn-block" type = "submit"> יצירת צ׳אט </button>
        <button (click) = "chooseChatRoom()" class = "btn btn-md btn-primary btn-block" type = "submit"> חזור לעמוד הקודם </button>

    </form>
  </div>

  <!-- /Create a new chat room -->
  <!-- ================================================================================================================================================ -->
  <!-- Chat messages -->

    <div *ngIf = "!noChatRoomSelected && !createNewChatRoom">

      <div class = "container">
        <div class = "row">
          <div class = "jumbotron text-center">
            <h4 class = "direction-rtl blue text-bold"> {{ chatRoomTitle }} </h4>
            <h6> {{ chatRoomAuthor }} </h6>
          </div>
        </div>
      </div>
      
      <div #scrollMe class = "vertical-menu messages">
        <div *ngFor = "let message of currentChat | async" > 
          <!--<div *ngIf = "needToPrint(message.timestamp | date: 'dd/MM/yy')">
            <p class = "date-stamp"> {{ message.timestamp | date: "dd/MM/yy" }} </p> 
          </div> -->
          <div class = "bubble" [class.bubble-alt] = "isMe(message.email)"  [class.yellow] = "!isMe(message.email)">
            <p id = "msg-name"> {{ message.displayName + ' ' + message.lastName }}</p>
            <p id = "msg-context"> {{ message.message }} </p>
            <div class = "author">
              <span id = "msg-time"> {{ message.timestamp | date: "hh:mm a" }} </span>
            </div>
          </div>
        </div>
      </div>

      <!-- /Chat messages -->

      <!-- =================== -->

      <!-- Send message input -->

      <div class = "input-group">
        <span class = "input-group-btn"> 
          <button class = "btn btn-primary" type = "submit" (click) = "sendMessage()"> <i class = "fa fa-arrow-up"></i> שלח </button>
        </span>  
        <input type = "text" class = "form-control" id = "msg-input" placeholder = "כתוב את הודעתך כאן.." (keyup.enter) = "sendMessage()" [(ngModel)] = "newMessage">
      </div>

      <!-- /Send message input -->

    </div>     
  </div>
</div>
<!-- ================================================================================================================================================ -->
